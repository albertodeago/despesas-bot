<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>DespesasBot how to</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon" />
    <style>
      /*! minireset.css v0.0.6 | MIT License | github.com/jgthms/minireset.css */
      html,
      body,
      p,
      ol,
      ul,
      li,
      dl,
      dt,
      dd,
      blockquote,
      figure,
      fieldset,
      legend,
      textarea,
      pre,
      iframe,
      hr,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
        padding: 0;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-size: 100%;
        font-weight: normal;
      }

      ul {
        list-style: none;
      }

      button,
      input,
      select {
        margin: 0;
      }

      html {
        box-sizing: border-box;
      }

      *,
      *::before,
      *::after {
        box-sizing: inherit;
      }

      img,
      video {
        height: auto;
        max-width: 100%;
      }

      iframe {
        border: 0;
      }

      table {
        border-collapse: collapse;
        border-spacing: 0;
      }

      td,
      th {
        padding: 0;
      }
    </style>
    <style>
      body {
        /* background-color: black; */
      }

      .stories {
        display: grid;
        height: 100vmax;
        border-radius: 1em;

        grid: 1fr / auto-flow 100%;
        gap: 1ch;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        overscroll-behavior: contain;
        touch-action: pan-x;
      }

      .user {
        scroll-snap-align: start;
        scroll-snap-stop: always;
        display: grid;
        grid: [story] 1fr / [story] 1fr;
      }

      .story {
        grid-area: story;

        background-size: cover;
        background-image: var(--bg),
          linear-gradient(to top, lch(98 0 0), lch(90 0 0));

        user-select: none; /* TODO: do we want this? */
        touch-action: manipulation;

        transition: opacity 0.3s cubic-bezier(0.4, 0, 1, 1);

        &:not(.active) {
          opacity: 0;
          pointer-events: none;
        }
      }

      .story-content {
        position: absolute;
        inset: 0;
        text-align: center;
        padding: 4em 2em;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <div class="stories">
      <section class="user">
        <!-- INTRO -->
        <article
          class="story active"
          style="--bg: url(backgrounds/bg-tacos.jpeg)"
        >
          <div class="story-content">
            <p>
              Segui questi semplici passi per iniziare ad utilizzare DespesasBot
            </p>
            <p>
              clicca a destra per andare al prossimo step, sinistra per tornare
              indietro, come fossero instagram stories
            </p>
          </div>
        </article>

        <!-- DUPLICATE SPREADSHEET -->
        <article class="story" style="--bg: url(backgrounds/bg-cactus.jpeg)">
          <div class="story-content">
            <p>
              Per prima cosa devi duplicare questo foglio di calcolo. Questo ha
              gi√† impostata la struttura che il bot si aspetta
            </p>
            <a
              href="https://docs.google.com/spreadsheets/d/1iKU8z1Oa6odHcjkiHCW1tfFLKNsi6SEb3Wgmcz_Twfk/edit#gid=965953449"
              target="_blank"
            >
              Link al foglio
            </a>
            <p>
              Puoi dargli il nome che vuoi, ma non devi cambiare le tab e la
              struttura delle pagine
            </p>
          </div>
        </article>

        <!-- EXPLAIN SPREADSHEET -->
        <article class="story" style="--bg: url(backgrounds/bg-sombrero.jpeg)">
          <div class="story-content">
            <p>
              Bene, ora, sempre nel foglio di calcolo, puoi impostare le
              categorie, secondo le <b>tue</b> necessit√† (tab <b>Categorie</b>).
            </p>
            <p>
              Nel foglio troverai degli esempi, puoi toglierle e mettere quelle
              che vuoi tu.
            </p>
            <p>
              L'importante √® che dev'esserci almeno una categoria. Io ti
              suggerisco di pensarci e di strutturarle come pensi sia meglio per
              te, utilizzandole potrai poi crearti dei resoconti con le spese
              suddivise per categoria.
            </p>
            <p>
              Nella prima colonna (chiamata <b>Lista categorie</b>) puoi mettere
              le categorie "di primo livello".
            </p>
            <p>
              Nelle colonne adiacenti (colonna B, C, D, ... e via dicendo) puoi
              mettere delle sotto-categorie della categoria
            </p>
            <p>
              Per esempio la categoria pu√≤ essere "mangiare" e le sue sotto
              categorie potrebbero essere "ristorante" "spesa" e "aperitivi"
            </p>
            <p>
              Non c'√® un giusto o sbagliato qui, devi impostarle come credi sia
              meglio per te
            </p>
            <p>
              Ricorda che potrai sempre cambiarle, DespesasBot semplicemente le
              andr√† a leggere ogni volta che inserisci una spesa per
              categorizzarla (quindi un eventuale cambiamento in futuro non √®
              retroattivo, ma il foglio √® sempre tuo, potrai sistemarlo se credi
              serva)
            </p>
          </div>
        </article>

        <!-- SHARE SPREADSHEET TO THE BOT -->
        <article class="story" style="--bg: url(backgrounds/bg-pinata.jpeg)">
          <div class="story-content">
            <p>
              Ora devi condividere a DespesasBot il foglio di calcolo e dargli
              ruolo <b>editor</b>
              L'email di DespesasBot √® üëá (cliccaci sopra per copiarla)
            </p>
            <p id="bot-email">
              despesasserviceaccount@despesasbot.iam.gserviceaccount.com
            </p>
          </div>
        </article>

        <!-- GET SPREADSHEET ID -->
        <article
          class="story"
          style="--bg: url(backgrounds/bg-margaritas.jpeg)"
        >
          <div class="story-content">
            <p>
              Abbiamo praticamente finito. Ora copiati l'<b>id</b> del foglio di
              calcolo.
            </p>
            <p>
              Se non sai qual'√®, √® la penultima parte dell'URL del foglio di
              calcolo. Per esempio, se l'URL del tuo foglio di calcolo √®
              `https://docs.google.com/spreadsheets/d/1qpyC0XzvTcKT6EISywvqESX3A0MwQoFDE8p-Bll4hps/edit#gid=0`
              l'ID sarebbe `1qpyC0XzvTcKT6EISywvqESX3A0MwQoFDE8p-Bll4hps`
              (quindi la parte prima di `/edit#gid=0`).
            </p>
          </div>
        </article>

        <!-- START USING THE BOT -->
        <article class="story" style="--bg: url(backgrounds/bg-jalapeno.jpeg)">
          <div class="story-content">
            <p>
              Ottimo, sei pronto ad iniziare a tracciare le spese. Ora apri una
              chat con il bot e lancia il comando `/start spreadsheet_id`
            </p>
            <p>
              Ricorda che questo bot √® open source, puoi trovare il codice e
              segnalare malfunzionamenti nel suo repo
            </p>
            <a
              href="https://github.com/albertodeago/despesas-bot"
              target="_blank"
              >Link</a
            >
          </div>
        </article>
      </section>
    </div>

    <!-- 
        TODO: tema dinamico in base a pref. utente
        TODO: layout a "storie di instagram?" (orizzontale o verticale?)
        TODO: desktop support
        TODO: puntini sotto per far capire quanti step sono
        TODO: tema messicano come colori e immagini
        -->
    <script>
      const stories = document.querySelector('.stories');
      const storiesList = document.querySelectorAll('.story');
      const median = stories.offsetLeft + stories.clientWidth / 2;

      const state = {
        current_story: stories.firstElementChild.lastElementChild,
        currentStoryIndex: 0,
      };

      // NAVIGATION
      stories.addEventListener('click', (e) => {
        // console.log(e.target.parentElement)
        const targetParent = e.target.parentElement ?? {};
        if (
          e.target.nodeName !== 'ARTICLE' &&
          targetParent.nodeName !== 'ARTICLE'
        ) {
          return;
        }

        navigateStories(e.clientX > median ? 'next' : 'prev');
      });
      document.addEventListener('keydown', ({ key }) => {
        if (key !== 'ArrowDown' || key !== 'ArrowUp')
          navigateStories(key === 'ArrowDown' ? 'next' : 'prev');
      });

      const navigateStories = (direction) => {
        if (direction === 'next') {
          if (state.currentStoryIndex + 1 >= storiesList.length) {
            return;
          }
          state.currentStoryIndex++;
        } else if (direction === 'prev') {
          if (state.currentStoryIndex <= 0) {
            return;
          }
          state.currentStoryIndex--;
        }

        [...storiesList].forEach((story, index) => {
          if (index === state.currentStoryIndex) {
            story.classList.add('active');
          } else {
            story.classList.remove('active');
          }
        });
      };
    </script>
  </body>
</html>
